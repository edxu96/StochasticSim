---
editor_options:
  chunk_output_type: console
---

# (PART) Statistics {-}

# Linear Regression Analysis (LRA) {#LRA}

```{r, include=F}
options(width = 80, pillar.sigfig = 5)
knitr::opts_chunk$set(
  comment = "#>",
  echo = F,
  fig.align="center"
)
rm(list = ls())
```

Following packages and functions are used in this chapter:

```{r packages, message=F, echo=T}
## basic packages
library(knitr)
library(kableExtra)
library(tidyverse)
library(conflicted)
library(magrittr)
library(broom)
## paticular packages for this project
library(lmtest)
library(corrr)
library(tseries)
library(corrplot)
library(car)
library(perturb)
source("../src/funcs.R")
source("../src/tests.R")
```

### Dataset `1980-us-census-part` {-}

```{r, message=F, echo=T}
dat_part <-
  read_csv("../data/1980-us-census-part.csv") %>%
  dplyr::select(part = Part, educ = schooling)
```

```{r, echo=T}
mods_part <- list()
mods_part[[1]] <- dat_part %>%
  as.data.frame() %>%
  {glm(part ~ educ, data = ., family = "binomial")}
mods_part[[2]] <- dat_part %>%
  as.data.frame() %>%
  {glm(part ~ 1, data = ., family = "binomial")}
```

### Dataset `1980-us-census` {-}

```{example, census, name='census', echo=T}
We will investigate a 0.01% subsample of the 1980 US census. From this subsample, we select all women of age 18 to 65 who are in the labor force, and who gave positive values in response to questions about weeks worked, usual hours worked per week, and wage income for the year 1979. This reduces the sample to 3877 observations. For the moment, we will focus on just one variable: wage income. For data protection reasons, wage income has been top–coded at US$ 75000 annually, meaning that any income higher than 75000 is truncated at that amount. As this truncation concerns only two women in the data, we will ignore it. We will look at the weekly wage, defined as the top-coded annual wage income divided by the number of weeks worked in 1979.
```

```{r 1980-us-census, message=F, warning=F, echo=T}
dat_census <-
  read_csv("../data/1980-us-census.csv") %>%
  mutate(wage_log = LwageW) %>%
  dplyr::select(educ, wage_log)
```

```{r, echo=T}
mods_census <- list()
mods_census[[1]] <- lm(wage_log ~ educ, data = dat_census)
mods_census[[2]] <- lm(wage_log ~ educ + I(educ^2), data = dat_census)
```

### Dataset `RECS` {-}

- [Residential Energy Consumption Survey (RECS)](https://www.eia.gov/consumption/residential/)

```{example, RECS, name='RECS', echo=T}
EIA administers the Residential Energy Consumption Survey (RECS) to a nationally representative sample of housing units. Traditionally, specially trained interviewers collect energy characteristics on the housing unit, usage patterns, and household demographics. For the 2015 survey cycle, EIA used Web and mail forms, in addition to in-person interviews, to collect detailed information on household energy characteristics. This information is combined with data from energy suppliers to these homes to estimate energy costs and usage for heating, cooling, appliances and other end uses — information critical to meeting future energy demand and improving efficiency and building design.
```

The data set is defined as follows based on file `recs.csv`:

```{r recs, message=F, echo=T}
set.seed(6)
dat_recs <-
  read_csv("../data/recs.csv") %>%
  dplyr::slice(sample(nrow(.), 300)) %>%
  mutate(y = log(KWH / NHSLDMEM)) %>%
  mutate(x8 = TOTROOMS + NCOMBATH + NHAFBATH) %>%
  dplyr::select(y, x2 = NHSLDMEM, x3 = EDUCATION, x4 = MONEYPY, x5 = HHSEX,
    x6 = HHAGE, x7 = ATHOME, x8) %>%
  mutate_at(seq(2, 8), as.integer) %>%  # make continuous variables discrete
  mutate(x5 = - x5 + 2)
```

Models used in the context are:

```{r, echo=T}
mods_recs <- list()
mods_recs[[1]] <- lm(y ~ x2 + x3 + x4 + x5 + x6 + x7, data = dat_recs)
mods_recs[[2]] <- lm(y ~ x2 + x3 + x4 + x6 + x7, data = dat_recs)
mods_recs[[3]] <- lm(y ~ x2 + x4 + x6 + x7, data = dat_recs)

mods_recs[[4]] <- lm(y ~ x2 + I(x2^2) + x8, data = dat_recs)
mods_recs[[5]] <-
  dat_recs %>%
  mutate(z1 = lm(x2 ~ 1)$residuals) %>%
  mutate(z2 = lm(x8 ~ x2 + 1)$residuals) %>%
  mutate(x2.2 = x2^2) %>%
  mutate(z3 = lm(x2.2 ~ x2 + x8 + 1)$residuals) %>%
  {lm(y ~ z1 + z2 + z3, data = .)}

mods_recs[[6]] <- lm(y ~ x2, data = dat_recs)
mods_recs[[7]] <-
  dat_recs %>%
  mutate(x1 = 1, x21 = x2 - mean(.$x2)) %>%
  dplyr::select(y, x1, x21) %>%
  {lm(y ~ x1 + x21, data = .)}
```

### Dataset `delivery` {-}

The dataset `delivery` is from [@montgomery2012introduction]:

```{r delivery, echo=T}
dat_delivery <- 
  readxl::read_xls("../data/delivery.xls", col_names = c("i", "time", "case",
    "dist"), skip = 1)
```

### Dataset `acetylene` {-}

The dataset `acetylene` is from [@montgomery2012introduction]:

```{r acetylene, echo=T}
dat_acetylene <-
  readxl::read_xls("../data/acetylene.xls", col_names = c("i", "p", "t_raw",
    "h_raw", "c_raw"), skip = 1) %>%
  mutate(t = (t_raw - 1212.5) / 80.623) %>%
  mutate(h = (h_raw - 12.44) / 5.662) %>%
  mutate(c = (c_raw - 0.0403) / 0.03164) %>%
  select(i, p, t, h, c)
```

### To-Learn {-}

- [x] confidence interval
- [x] MSA
- [x] Likelihood Ratio Test
- [x] strong exogeneity 
- [x] ANOVA
- [x] Orthogonalization

```{r child = '../docs/LRA-visual.Rmd'}
```

```{r child = '../docs/LRA-PSM.Rmd'}
```

```{r child = '../docs/LRA-multi.Rmd'}
```

```{r child = '../docs/LRA-factor.Rmd'}
```

```{r child = '../docs/LRA-infer.Rmd'}
```

```{r child = '../docs/LRA-MSA.Rmd'}
```

```{r child = '../docs/LRA-mediation.Rmd'}
```

